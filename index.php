<?php/*** @package WMSG CONTACT FORM* @version 2.0.4*//*Plugin Name: WMSG CONTACT FORMPlugin URI: http://www.teknoltan.com/Description: Bu Eklenti Kullanıcılarınızın Size Gönderdiği Form'u WhatsApp Üzerinden Hızlıca İletilmesini Sağlar. Kısa Kod : [WMSG] Author: TEKNOLTANVersion: 2.0.4Author URI: http://teknoltan.com*/error_reporting(0);define( 'API_URL', 'https://teknoltan.com/files/wmsg/api.php' );add_action('admin_menu', 'wmsg_menu');function wmsg_menu(){  add_menu_page('WMSG FORM','WMSG FORM', 'manage_options', 'wmsg_panel', 'wmsg_panel', plugins_url( '/assets/images/icon.png', __FILE__ ), 25);}function wmsg_panel() {  require_once("tekno_panel.php");}function wmsg_form_enqueue_scripts() {  $gReCap_key = get_option("gReCap_key");  wp_enqueue_script( 'wmsg-alert-js', plugins_url( '/assets/js/wmsg_alert.js', __FILE__ ) , array(), false, true );  wp_enqueue_script( 'wmsg-script', plugins_url( '/assets/js/wmsg_form.js', __FILE__ ), array('jquery'), false, true );      wp_enqueue_script( 'wmsg-recaptcha', 'https://www.google.com/recaptcha/api.js?onload=CaptchaCallback&render=explicit', array(), false, true );  wp_add_inline_script( 'wmsg-recaptcha', "    var wmsg_recaptcha1;    var wmsg_recaptcha2;    var CaptchaCallback = function() {      if ( jQuery('#wmsg_recaptcha1').length ) {        wmsg_recaptcha1 = grecaptcha.render('wmsg_recaptcha1', {          'sitekey' : '$gReCap_key',           'theme' : '".get_option("RECAPTCHA_THEME")."'          });        }        if ( jQuery('#wmsg_recaptcha2').length ) {          wmsg_recaptcha2 = grecaptcha.render('wmsg_recaptcha2', {            'sitekey' : '$gReCap_key',             'theme' : '".get_option("RECAPTCHA_THEME")."'            });          };        };"      );  wp_enqueue_style( 'wmsg-ubuntu-font', '//fonts.googleapis.com/css?family=Ubuntu' );  wp_enqueue_style( 'wmsg-style', plugins_url( '/assets/css/wmsg_form.css', __FILE__ )."?".rand(10000,99999) );  wp_localize_script( 'wmsg-script', 'wmsg_form_ajax', array(    'ajax_url' => admin_url( 'admin-ajax.php' ),    'ajax_nonce' => wp_create_nonce('wmsg_ajax_nonce'),  ));}add_action( 'wp_enqueue_scripts', 'wmsg_form_enqueue_scripts' );function wmsg_form_admin_enqueue_scripts($hook) {     if($hook!= 'toplevel_page_wmsg_panel') {            return;        }    wp_enqueue_style( 'wmsg-admin-bootstrap4-css', plugins_url( '/assets/css/bootstrap.min.css', __FILE__ ) );    wp_enqueue_style( 'wmsg-admin-style', plugins_url( '/assets/css/wmsg_form_admin.css', __FILE__ ) );    wp_enqueue_style( 'wmsg-admin-colorpicker', plugins_url( '/assets/css/tinycolorpicker.css', __FILE__ ) );    wp_enqueue_script( 'wmsg-admin-fa-icon', "https://kit.fontawesome.com/99f20d2888.js" , array(), false, true);    wp_enqueue_script( 'wmsg-admin-bootstrap4-js', plugins_url( '/assets/js/bootstrap.min.js', __FILE__ ) , array(), false, true );    wp_enqueue_script( 'wmsg-admin-colorpicker-js', plugins_url( '/assets/js/jquery.tinycolorpicker.js', __FILE__ ) , array(), false, true );    wp_enqueue_script( 'wmsg-admin-js', plugins_url( '/assets/js/wmsg_admin.js', __FILE__ ) , array(), false, true );  }add_action( 'admin_enqueue_scripts', 'wmsg_form_admin_enqueue_scripts' );function recaptcha_reset( $recaptcha_id ) {  echo "<script>grecaptcha.reset(wmsg_recaptcha$recaptcha_id);</script>";}function wmsg_form_ajax() {  check_ajax_referer( 'wmsg_ajax_nonce', 'security' );  $wmsg_apikey = get_option("wmsg_apikey");  $gReCap_sec = get_option("gReCap_sec");  $wmsg_phone = get_option("wmsg_phone");  if( !$_POST['data'] ) {    return false;  }  parse_str( $_POST['data'], $data );  $userName = sanitize_text_field( $data["k_adsoyad"] );  $userMessage = sanitize_text_field( $data["k_mesaj"] );  $userIP = sanitize_text_field( $_SERVER['REMOTE_ADDR'] );  $userContact = sanitize_text_field( $data["k_iletisim"] );  $siteUrl = get_site_url();  $recaptcha_id = intval($_POST['recaptcha']);  $recaptcha = $data['g-recaptcha-response'];  if (!empty($recaptcha)) {    $google_url = "https://www.google.com/recaptcha/api/siteverify";    $secret = $gReCap_sec;    $ip = $_SERVER['REMOTE_ADDR'];    $connect_url = "$google_url?secret=$secret&response=$recaptcha&remoteip=$ip";    $response = wp_remote_get( $connect_url );    if( is_array( $response ) && array_key_exists( 'body', $response ) ) {      $response = json_decode( $response['body'], true );      if( $response['success'] ) {        if( strlen( $userName ) < 4 ) {          echo "Ad Soyad 4 Karakterden Küçük Olamaz !";        } else {          if (strlen($userName) > 25) {            recaptcha_reset( $recaptcha_id );            echo "Ad Soyad 25 Karakterden Büyük Olamaz !";          }else{            if (strlen($userMessage) < 10) {              recaptcha_reset( $recaptcha_id );                            echo "Mesajınız 10 Karakterden Küçük Olamaz !";            }else{              if (strlen($userMessage) > 1923) {                recaptcha_reset( $recaptcha_id );                                echo "Mesajınız 1923 Karakterden Büyük Olamaz !";              }else{                  if (strlen($userContact) > 40) {                  recaptcha_reset( $recaptcha_id );                  echo "İletişim Bilgisi 40 Karakterden Büyük Olamaz !";                }else{                  if (strlen($userContact) < 8) {                    recaptcha_reset( $recaptcha_id );                    echo "İletişim Bilgisi 8 Karakterden Küçük Olamaz !";                  }else{                   $url = "https://wa.teknoltan.com/api/wmsg/?apikey=".$wmsg_apikey;                   $response = wp_remote_post( $url, array(                    'method'      => 'POST',                    'timeout'     => 45,                    'redirection' => 5,                    'httpversion' => '1.0',                    'blocking'    => true,                    'headers'     => array(),                    'body'        => array(                      'adminPhone' => $wmsg_phone,                      'userContact' => $userContact,                      'userMessage' => $userMessage,                      'userIP' => $userIP,                      'userName' => $userName,                      'siteUrl' => $siteUrl                                          ),                    'cookies'     => array()                  )                 );                   if ( !is_wp_error( $response ) ) {                    $durums = json_decode($response["body"]);                    $durum = sanitize_text_field($durums->status);                    if($durum=="success"){                      echo "<script>                      document.getElementById('wmsg_id01').style.display='none';                      $('#wmsg_veriler2').trigger('reset');                      $('#wmsg_veriler').trigger('reset');                      Swal.fire({                        position: 'center',                        icon: 'success',                        title: '".sanitize_text_field($durums->result)."',                        showConfirmButton: false,                        timer: 3000                      })</script>";                                          }else{                      echo "<script>                      Swal.fire({                        position: 'center',                        icon: 'error',                        title: '".sanitize_text_field($durums->result)."',                        showConfirmButton: false,                        timer: 3000                      })</script>";                           }                  }                          }              }            }          }        }      }    } else {      recaptcha_reset( $recaptcha_id );      echo "Lütfen bot olmadığınızı doğrulayın.";    }  }} else {  recaptcha_reset( $recaptcha_id );  echo "Lütfen bot olmadığınızı doğrulayın.";}wp_die();}add_action( 'wp_ajax_nopriv_wmsg_form_ajax', 'wmsg_form_ajax' );add_action( 'wp_ajax_wmsg_form_ajax', 'wmsg_form_ajax' );function wmsg_popup_form() {  $wmgs_pop_form = get_option("wmgs_pop_form");  if ($wmgs_pop_form == "on"){    require_once( "form_view.php" );  }}add_action( 'wp_footer', 'wmsg_popup_form' );function wmsg_form_shortcode() {  $wmsg_form_out = "  <div id='WMSG_MAXW'>  <div id='wmsg_head'>  ".get_option("FORM_TITLE")." <span class='dashicons dashicons-format-status'></span>  </div>   <div id='wmsg_div2'>  <form autocomplete='off' method='post' id='wmsg_veriler2'>  <label id='wmsg_label2'><span class='dashicons dashicons-admin-users'></span> <b>Ad Soyad</b> (Min 4, Max 25 Karakter)</label>  <input  autocomplete='off'  type='text' id='wmsg_giris2' name='k_adsoyad' placeholder='Adınız Soyadınız'><br>  <label id='wmsg_label2'><span class='dashicons dashicons-info'></span> <b>İletişim Bilgisi</b> (Min 8, Max 40 Karakter)</label>  <input autocomplete='off'  type='text' id='wmsg_giris2' name='k_iletisim' placeholder='Telefon No Veya E-Posta Adresi'>  <label id='wmsg_label2'><span class='dashicons dashicons-admin-comments'></span> <b>Mesaj</b> (Min 10, Max <b>1923</b> Karakter)</label>  <textarea type='text' style='height:200px;' id='wmsg_giris2' name='k_mesaj' placeholder='Mesajınızı Giriniz'></textarea>  <div id='wmsg_bekle2'></div>  <div id='wmsg_gelenveri2'></div>  <div>  <div style='text-align: center;max-height: 78px;overflow: hidden;'>  <div style='display: inline-block;' id='wmsg_recaptcha1'></div>   </div>    </div>  <button id='wmsg_button2' type='button'>GÖNDER <span class='dashicons dashicons-arrow-right-alt'></span></button>  </form>  </div>  </div>";  return $wmsg_form_out;}add_shortcode("WMSG","wmsg_form_shortcode");function load_dashicons(){    wp_enqueue_style('dashicons');}add_action('wp_enqueue_scripts', 'load_dashicons');add_filter( 'plugin_action_links_' . plugin_basename(__FILE__), 'add_action_links' );function add_action_links ( $links ) {    $wmsg_adsettings = array(        '<a href="' . admin_url( 'admin.php?page=wmsg_panel' ) . '">Ayarlar</a>',                '<a href="' . esc_url( 'https://wa.teknoltan.com/magaza' ) . '" target="_blank" style="font-weight:bold;">' . esc_html__( 'Kredi Ekle', 'domain' ) . '</a>',        '<a href="' . esc_url( 'https://wordpress.org/plugins/wmsg-contact-form/#installation' ) . '" target="_blank">' . esc_html__( 'Kurulum Rehberi ?', 'domain' ) . '</a>'    );    return array_merge( $links, $wmsg_adsettings );}add_filter( 'plugin_row_meta', 'wk_plugin_row_meta', 10 ,2);function wk_plugin_row_meta( $links, $file ) {        if ( plugin_basename( __FILE__ ) == $file ) {        $row_meta = array(          'docs'    => '<a href="' . esc_url( 'https://login.wordpress.org/?redirect_to=https://wordpress.org/support/plugin/wmsg-contact-form/reviews/?rate=5#new-post' ) . '" target="_blank" style="color:red; font-weight:bold;">' . esc_html__( 'Puan ver', 'domain' ) . '</a>',          'sorun'    => '<a href="' . esc_url( 'https://teknoltan.com/iletisim/' ) . '" target="_blank" style="color:green;">' . esc_html__( 'Sorun Bildir', 'domain' ) . '</a>'		          );        return array_merge( $links, $row_meta );    }    return (array) $links;}?>